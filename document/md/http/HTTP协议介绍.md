 ### HTTP协议介绍



| 作者                 | 时间       | QQ技术交流群                      |
| -------------------- | ---------- | --------------------------------- |
| perrynzhou@gmail.com | 2020/12/16 | 中国开源存储技术交流群(672152841) |

- http协议是超文本出书协议(HyperText  Transfer Protocol),该协议分为超文本、传输、协议三个部分。
  - 超文本:包括文字、图片、视频等资源
  - 协议:确定客户端和服务器之间通信方式的约定
  - 传输:客户端和服务器之间的请求数据、响应数据的搬运，HTTP是一个双向协议
- HTTP状态码
  - 1xx:提示信息，表示目前是协议处理的中间状态，后续需要继续操作
  - 2xx:成功状态，报文已经被接受并且正确被处理
  - 3xx:重定向，资源位置发生变化，需要客户端重新发送请求
  - 4xx:客户端错误，请求报文有错误，服务器无法处理
  - 5xx:服务器错误，服务器在处理请求时内部发生错误
- HTTP常用字段
  - Host 字段:客户端发送请求时，用来指定服务器的域名
  - Content-Length 字段:服务器在返回数据时，会有Content-Length字段，表明本次回应的数据长度
  - Connection 字段:常用于客户端请求服务器使用TCP持久连接，以便其他请求复用。HTTP/1.1版本的默认连接都是持久连接，为了兼容HTTP/1.1之前，需要指定Connection首部字段为 Keep-Alive字段，这样一个可以复用TCP连接就建立了，知道客户端或者服务器主动关闭连接，但是这个字段不是标准字段
  - Content-Type 字段:用于服务器回应时，告诉客户端，本次数据是什么格式。
  - Content-Encoding 字段: 说明数据的压缩方法，表示服务器返回数据使用什么压缩格式，比如"Content-Encoding gzip"表示服务器返回数据采用gzip方式压缩，告知客户端需要用此方式解压。在客户端请求时,用 "Accept-Encoding"字段说宁自己客户以接受哪些压缩方法
- GET和POST主要区别
  - GET方法主要是从服务器获取数据，仅仅是 一个只读的请求，请求资源可以是静态的文本、文件、页面、图片视频等
  - POST方法是向服务器写入数据，这是一个只写的请求，URI指定的资源提交数据，数据就放到HTTP协议中的报文中
  - GET请求永远是安全和幂等操作，因为GET方法仅仅是一个只读的操作，不会破坏服务器上资源，这个保证了安全；与此同时，在服务器资源不变的情况下,多次执行GET请求，返回的结果都是相同的。
  - POST请求是新增或者提交数据的写操作，会修改服务器上的资源，因此这个操作是不安全的，同时多次提交数据会创建或者修改多个资源，所以不是幂等操作。
- HTTP协议分析
  - 优点:简单、灵活和易于扩展、使用广泛。简单体现在HTTP报文格式上，这个格式基本是header+body,易于理解；HTTP协议中各类请求方法、URI/URL、状态码、头字段等每个组成要求都没有被固定，都允许开发人员自定义和扩充。HTTP是工作在OSI模型的第七层的应用层，则它的下层可以随便变化。比如https也是在http和tcp之间增加了SSL/TLS安全传输、HTTP/3协议深圳把TCP层换成了基本UDP的quic协议
  - 缺点: 无状态、不安全。无状态体现在如果有一个关联性的操作，要完成操作比较麻烦，例如登陆->添加购物车->下单->结算->支付，这系列操作都需要知道用户身份才行。但是服务器不知道这些请求时有关联的，每次都需要验证身份，比较通用解决HTTP无状态问题，就是用Cookie技术。不安全体现在使用了明文传输，很容易被窃取、篡改、伪装。
- HTTP/1.1特性和性能
  - HTTP协议是基于TCP/IP协议,并且使用了“请求-应答”的通信模式，所以性能的关键点也体现在这里。
  - HTTP/1.1采用了长连接，在早起的HTTP/1.0性能有一个很大的问题就是每次发起一个请求，都需要建立一次TCP连接(三次握手)。而且是串行请求，做了很多没有必要的TCP连接和断开操作，增加了通信的开销，而HTTP/1.1 采用了长连接方式，也叫持久连接，这种方式较少了TCP的重复连接和断开所在成的额外开销，同时也减轻了服务端的负载。同时持久连接的它特点是，只要任意一端没有明确提出断开连接，则保持TCP的连接状态
  - HTTP/1.1采用了管道网络传输方式，在同一个TCP连接里面，客户端可以发起多个请求，只要第一个请求发出去了，不必等其响应，就可以发送第二个请求，这样可以减少整体的响应时间。例如，客户端请求2个资源A和B，在HTTP/1.0时代,在同一个TCP连接里面，发送A请求，然后等待客户端收到服务器针对A请求的响应，然后才可以发送B请求；而在HTTP/1.1的管道机制允许客户端同时发送A和B请求，但是服务器还是会按照顺序处理，先回应A请求的响应，完成后在回应B请求的响应。要是A请求的响应特别慢，后面会有许多请求排队等着，这个就是【队头阻塞】
- HTTP/1.1分析
  - 优势
    - HTTP/1.1使用了长连接改善了HTTP/1.0短连接造成的性能开销
    - 支持管道网络传输，只要第一个请求发出去了，不必等其回来，就可以发第二个请求
      出去，可以减少整体的响应时间。
  - 劣势
    - 请求/响应头部未经压缩就发送，首部信息越多延迟就越大。只能压缩Body的部分
    - 发送冗长的首部。每次相互发送相同的首部会造成浪费的较多
    - 服务器是按照请求的顺序来响应的，如果服务器响应慢，会导致客户端一直请求不到数据，也就是【队头阻塞】
    - 没有请求优先级控制的特性
    - 请求只能从客户端发起开始，服务器只能被动响应
- HTTP/2协议分析
  - 相比于HTTP/1.1,HTTP/2采用了压缩头技术，如果溶蚀发送多个请求，他们的头是一样的或者是相似的，那么HTTP/2会消除重复的部分
  - HTTP/2不像HTTP/1.1那样的纯文本形式的报文，而是全面采用二进制格式，头信息和数据体都是二进制，并且统称为帧(frame),这包括头信息帧和数据帧。增加了数据传输的效率
  - HTTP/2采用了数据流技术，数据包发送不是按照顺序发送的，同一个连接里面连续的数据包，可能属于不同的回应，必须对数据包做标记，并且指出它属于哪个回应。每个请求或者回应的所有数据包，称为一个数据流，每个数据流都标记这独一无二的编号，其中规定客户端发出的数据流编号为奇数，服务端发出的数据流编号为偶数。客户端还可以指定数据流的优先级，优先级高的请求，服务器就先处理该请求
  - HTTP/2采用了多路复用奇数，可以在一个连接中并发多个请求或者响应，而不是按照顺序一一对应，移除了 HTTP/1.1 中的串行请求，不需要排队等待，也就不会再出现「队头阻塞」问题，降低了延迟，大幅度提高了连接的利用率。举例来说，在一个 TCP 连接里，服务器收到了客户端 A 和 B 的两个请求，如果发现 A 处理过程非常耗时，于是就回应 A 请求已经处理好的部分，接着回应 B 请求，完成后，再回应 A 请求剩下的部分
  - HTTP/2协议中，在一定程度改善了传统的“请求-响应”的工作模式，服务端不在是被动的响应，也可以主动的向客户端发送消息。举例来说，在浏览器刚请求 HTML 的时候，就提前把可能会用到的 JS、CSS 文件等静态资源主动发给客户端，减少延时的等待，也就是服务器推送（Server Push，也叫 Cache Push）
