## nginx概述

| 作者 | 时间 |QQ技术交流群 |
| ------ | ------ |------ |
| perrynzhou@gmail.com |2020/07/23 |中国开源存储技术交流群(672152841) |


### 开源版本nginx特性

- 访问路由，通过访问路径、URL关键字、客户端IP、灰度分流等多种方式实现访问路由分配
- 方向代理,自身不产生数据，只是应用自身的非异步阻塞事件驱动架构，高效，稳定的将请求反向代理给后端的目标应用服务器，并把响应数据返回给客户端
- 负载均衡，upstream模块支持多种负载均衡算法，使后端服务器可以非常方便地进行横向扩展。
- 内容缓存，支持静态文件和动态请求结果的内存缓存
- 可编程，其设计的高度模块化，可以使用C语言或者lua轻松的扩展

### 商业版nnginx plus

- 负载均衡，支持DNS动态更新
- 动态管理，支持通过API清除内容缓存，同时支持API动态管理上游后端服务器列表
- 安全控制，新增API单点登录的JWT认证、Nginx WAF动态模块
- 状态监控，提供实时的图形监控面板
- 流媒体，支持自适性串流和对MP4媒体流进行贷款控制
  
### Tenginx特性

- 继承所有nginx 1.17.3特性
- 支持HTTP的connect方法，用于正向代理
- 增强运维相关功能
- stream模块支持server_name命令
- 支持输入过滤机制
- 支持设置proxy、memcached、fastcgi等在后端失败时重试次数
- 支持lua语言
- 支持访问速度模块


### openresty特性

- openresty基于开源nginx版本，利用nginx模块特性使nginx支持lua语言的脚本编程。
- openresty架构在nginx和luajit基础之上，openresty为每个nginx工作进程创建一个lua虚拟机，并将nginx io原语封装注入lua虚拟机提供给lua代码访问，每个外部请都由Lua虚拟机产生一个lua 协程进行处理，协程之间数据彼此隔离并共享lua虚拟机。当lua代码调用异步接口时,会挂起当前协程以不阻塞nginx工作进程，等异步接口处理完毕后再还原当前协程继续运行

### nginx架构特点

- 多进程模型，进程之间通过信号、unix 套接字进行通信、共享内存进行通信；信号是master进程接受到信号，通过unix套接字传递给worker进程进行相关操作；配置文件、连接时候的共享锁信息都是在共享内存内，每个worker进程读取内向内存的信息以便进行处理
- nginx有两种进程调度模式，每个worker内会监听相同的一个或者多个端口，当前有请求到达，默认是每个worker进程进行资源抢夺，哪个worker抢到了就由那个worker进行处理；另外一种是在共享内存内设置一把锁，每个、worker进行先去获取锁，谁拿到了锁，谁就去处理请求

### nginx源码模块
- 核心模块(core),提供nginx运行基本服务
- 事假驱动(event),封装IO网络模型
- http模块(http),提供http所有处理的核心功能
- stream模块，提供tcp/udp会话代理和负载相关功能