## tcp是一种流式协议


| 作者 | 时间 |QQ技术交流群 |
| ------ | ------ |------ |
| perrynzhou@gmail.com |2020/11/23 |中国开源存储技术交流群(672152841) |

- tcp是一种流式协议，数据以字节流的形式传递给接受者，没有继承”报文“和”报文边界“的概念，读取TCP数据就像从串行端口读取数据一样，无法预先得知在一次指定的read调用中返回多少字节
- 主机A应用发送M1,M2两个报文到主机B，一般会人物M1和M2是两个独立的报文，并调用2次send,每条报文各调用一次，这样的的假象。实际上TCP可能不会遵循这个模型，主机A发送M1和M2,调用send仅仅是把M1和M2数据放到主机A的TCP协议栈的发送窗口，数据的实际发送是按照滑动窗口/路径上最大传输单元，把M1和M2数据分组，每个分组在每一层(tcp/ip/链路)添加头部，发送到主机B。
- send调用完毕仅仅说明，数据已经从用户态拷贝到主机的TCP协议栈的发送缓冲区，M1和M2的分组数据，达到主机B，经过去掉每层的协议头，数据拷贝到主机B的TCP协议栈的接受缓存区。主机B在接受过程M1和M2分组过程中，可能出现乱序，这时候会启动快速重传，把乱序的包填补完成后，在让主机B的应用程序使用recv读取数据
- 主机A发送M1和M2到主机B，主机B可能发生如下4种情况
  - 没有数据可读取，主机B的应用程序阻塞
  - 主机B的应用策程序获取到M1的部分数据
  - 主机B的应用程序获取到M1的所有分组数据，除此之外没有任何其他内容
  - 主机B的应用程序获取到M1的所有数据和M2部分或者M2全部数据
- TCP分组中的数据量和send调用中传递给TCP多少数据么有直接的关系，而且接受端也没有什么可靠办法可以判断数据是如何被分组的。
